services:
  redis:
    image: redis:7
    container_name: insightplus-redis
    ports:
      - "6379:6379"
    restart: unless-stopped

  clickhouse:
    image: clickhouse/clickhouse-server:latest
    container_name: insightplus-clickhouse
    environment:
      - CLICKHOUSE_DB=insightplus
    ports:
      - "8123:8123"
      - "9000:9000"
    volumes:
      - ./clickhouse_data:/var/lib/clickhouse
    restart: unless-stopped

  postgres:
    image: postgres:16
    container_name: insightplus-postgres
    environment:
      - POSTGRES_DB=insightplus
      - POSTGRES_USER=insightuser
      - POSTGRES_PASSWORD=insightpass
    ports:
      - "5432:5432"
    volumes:
      - ./pg_data:/var/lib/postgresql/data
    restart: unless-stopped

  # backend:
  #   build: .
  #   container_name: insightplus-backend
  #   env_file: .env
  #   ports:
  #     - "7002:7002"
  #   depends_on:
  #     - redis
  #     - clickhouse
  #     - postgres
  #   restart: unless-stopped

  # worker:
  #   build: .
  #   container_name: insightplus-worker
  #   env_file: .env
  #   command: ["node", "worker/index.js"]
  #   depends_on:
  #     - redis
  #     - clickhouse
  #     - postgres
  #   restart: unless-stopped
